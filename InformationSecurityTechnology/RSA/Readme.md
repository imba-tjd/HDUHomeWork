# 实验四&六：RSA公钥加密和数字签名算法

此实验需要用到VS2010，可以从 <http://tieba.baidu.com/p/4934138327> 此贴下载并安装到虚拟机中。另外经过测试，VS2008是无法直接打开项目的。

## 公钥加密实验内容

1. 熟悉MPIR大整数运算库函数的调用。
2. 利用MPIR大整数运算库函数，实现RSA公钥加密算法。要求：
   1. RSA模数为2048bit。
   2. 能对一个数据（例如，16进制数“1234567890ABCDEF”）进行加密、解密。

## 公钥加密算法基本原理

### 1. 密钥生成算法

1. 随机生成两个不同大素数p,q。
2. 计算`n=pq`，`phi(n)=(p-1)(q-1)`。
3. 随机选取整数e，`1<e<phi(n)`,满足`gcd(e,phi(n))==1`。
4. 利用mpz自带的函数求出满足`e^d=1 mod(phi(n))`的整数d。
5. 公开`(n,e)`，保密`(p,q,phi(n),d)`。其中e就是加密密钥，而d就是解密密钥，n称为模数。

### 2. RSA加解密

若B要利用A的公钥进行加密，则B执行：

1. 获得A可信的公钥`(n,e)`。
2. 把消息按分组的方式表示为区间`[0,n-1]`之间的整数m。
3. 计算`c=Ee(m)=m^e mod n`。
4. 将密文c发送给A。

解密：为从c中恢复明文m，A利用解密密钥d，计算`m=c^d mod n`。

## 公钥加密实验过程

先了解了一下.lib文件是什么，此处的是静态库。尝试用mingw编译，失败；尝试把lib转换成.a，失败。老老实实在虚拟机里装了一个vs2010，编译成功。又试了一下把后缀改成c，一堆error。只能在后缀为cpp的文件里写c了。

vs2010默认不显示行号，搜了一下怎么显示。编译时会给出一大堆的warning LNK4099：未找到PDB，搜了一下怎么禁止warning，但是点重新生成解决方案的时候一定还会全部跳出来，不知道是我没设置好还是是feature。

mpz_t这种风格的调用我之前就能理解，配和老师给的精简过的库函数使用手册和示例，写起来难度不大，跟着ppt一步步走就好了。但是如果有bug，就只能人肉观察了，调试是非常困难的，因为所有mpz_t变量的状态都不好观察。

另外理论上这样只能加密长度小于n的数据，否则需要报错，这个我没做。还有不能直接读文件，需要一定的转换。

## 数字签名实验内容

利用MPIR大整数运算库函数，实现RSA数字算法，要求：
    1. RSA模数为2048bit。
    2. 能对任意文件进行签名、验证（调用MD5散列函数求文件的散列值，再对散列值进行签名）。

## 数字签名实验原理

    1. 读取文件，生成md5值。利用实验五。
    2. 生成RSA公钥和私钥。
    3. 用私钥加密，公钥解密。

## 数字签名实验过程

把getmd5分离了一下。因为RSA要在VS里做，就直接include cpp了。

为了复用代码，加解密的密钥改成了指针解引。

最后的结果倒是没什么区别。不过意外发现了实验四有几率失败，且没有解决，见[issue#5](https://github.com/imba-tjd/HDUHomeWork/issues/5)。
